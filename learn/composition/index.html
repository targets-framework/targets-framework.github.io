<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.47.1" />
    <meta name="description" content="how to compose your targets into workflows">
<meta name="author" content="Mac Heller-Ogden">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>composition :: targets</title>
    
    
    <link href="/css/nucleus.css?1535343902" rel="stylesheet">
    <link href="/css/font-awesome.min.css?1535343902" rel="stylesheet">
    <link href="/css/hybrid.css?1535343902" rel="stylesheet">
    <link href="/css/featherlight.min.css?1535343902" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1535343902" rel="stylesheet">
    <link href="/css/auto-complete.css?1535343902" rel="stylesheet">
    <link href="/css/theme.css?1535343902" rel="stylesheet">
    <link href="/css/hugo-theme.css?1535343902" rel="stylesheet">
    
      <link href="/css/theme-targets.css?1535343902" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1535343902"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/learn/composition/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg xmlns="http://www.w3.org/2000/svg" width="230" height="70" viewBox="0 0 1747 361">
<defs>
    <style>
      .cls-1 {
        fill: #376993;
      }

      .cls-1, .cls-2 {
        fill-rule: evenodd;
      }

      .cls-2 {
        fill: #93376f;
      }
    </style>
  </defs>
  <path id="targets" class="cls-1" d="M435.235,69.008H344.6V0.4H315V234.744a42.359,42.359,0,0,0,12.638,30.872q12.635,12.821,31.053,12.818h76.549V248.826H358.686A14.179,14.179,0,0,1,344.6,234.744V98.616h90.631V69.008Zm27.438,0V98.616H632.02A14.18,14.18,0,0,1,646.1,112.7v46.219H462.673v75.827a43.764,43.764,0,0,0,43.691,43.69H676.071V112.7a43.766,43.766,0,0,0-44.051-43.69H462.673Zm43.691,179.818a14.18,14.18,0,0,1-14.083-14.082V188.525H646.1v60.3H506.364Zm217.91-167A42.081,42.081,0,0,0,711.456,112.7V278.434h29.608V112.7a14.18,14.18,0,0,1,14.082-14.082H872.859V69.008H755.146A42.085,42.085,0,0,0,724.274,81.826ZM1105.39,112.7a42.374,42.374,0,0,0-12.64-30.872q-12.63-12.813-31.05-12.818H936.045a43.764,43.764,0,0,0-43.69,43.69V234.744a43.764,43.764,0,0,0,43.69,43.69H1075.78V317.07a14.173,14.173,0,0,1-14.08,14.082H930.99v29.97H1061.7q18.42,0,31.05-12.819a42.8,42.8,0,0,0,12.64-31.233V112.7ZM926.116,244.673a13.529,13.529,0,0,1-4.153-9.929V112.7a14.18,14.18,0,0,1,14.082-14.082H1061.7a14.175,14.175,0,0,1,14.08,14.082V234.744a14.175,14.175,0,0,1-14.08,14.082H936.045A13.533,13.533,0,0,1,926.116,244.673ZM1180.86,69.008a43.768,43.768,0,0,0-43.69,43.69V234.744a43.767,43.767,0,0,0,43.69,43.69h169.71V248.826H1180.86a14.175,14.175,0,0,1-14.08-14.082V188.525h183.79V112.7a42.11,42.11,0,0,0-12.82-30.872,42.535,42.535,0,0,0-31.24-12.818H1180.86Zm-14.08,43.69a14.175,14.175,0,0,1,14.08-14.082h125.65A14.192,14.192,0,0,1,1320.6,112.7v46.219H1166.78V112.7Zm341.21-43.69h-90.63V0.4h-29.61V234.744a42.357,42.357,0,0,0,12.64,30.872q12.63,12.821,31.05,12.818h76.55V248.826h-76.55a14.175,14.175,0,0,1-14.08-14.082V98.616h90.63V69.008Zm226.58,12.818a42.535,42.535,0,0,0-31.24-12.818H1577.68a43.751,43.751,0,0,0-43.69,43.69v32.137a43.75,43.75,0,0,0,43.69,43.69h125.65a14.175,14.175,0,0,1,14.08,14.082v32.137a14.175,14.175,0,0,1-14.08,14.082H1577.68a14.193,14.193,0,0,1-14.09-14.082v-2.889h-29.6v2.889a43.75,43.75,0,0,0,43.69,43.69h125.65a42.515,42.515,0,0,0,31.24-12.818,42.084,42.084,0,0,0,12.81-30.872V202.607a42.1,42.1,0,0,0-12.81-30.872,42.534,42.534,0,0,0-31.24-12.818H1577.68a14.193,14.193,0,0,1-14.09-14.082V112.7a14.192,14.192,0,0,1,14.09-14.082h125.65a14.175,14.175,0,0,1,14.08,14.082v2.889h29.97V112.7A42.1,42.1,0,0,0,1734.57,81.826Z"/>
  <path id=":_:" data-name=": :" class="cls-2" d="M-0.223,278.058H55.023V222.813H-0.223v55.245Zm0-209.426v55.607H55.023V68.632H-0.223ZM176.34,278.058h55.246V222.813H176.34v55.245Zm0-209.426v55.607h55.246V68.632H176.34Z"/>
</svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1535343902"></script>
<script type="text/javascript" src="/js/auto-complete.js?1535343902"></script>
<script type="text/javascript">
    
        var baseurl = '\/';
    
</script>
<script type="text/javascript" src="/js/search.js?1535343902"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/learn/" title="learn targets" class="dd-item 
        parent
        
        
        ">
      <a href="/learn/">
          <b>1. </b>learn targets
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/learn/overview/" title="overview" class="dd-item 
        
        
        
        ">
      <a href="/learn/overview/">
          overview
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/prerequisites/" title="prerequisites" class="dd-item 
        
        
        
        ">
      <a href="/learn/prerequisites/">
          prerequisites
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/installation/" title="installation" class="dd-item 
        
        
        
        ">
      <a href="/learn/installation/">
          installation
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/hello_world/" title="hello world" class="dd-item 
        
        
        
        ">
      <a href="/learn/hello_world/">
          hello world
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/config_part_1/" title="config - part 1" class="dd-item 
        
        
        
        ">
      <a href="/learn/config_part_1/">
          config - part 1
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/config_part_2/" title="config - part 2" class="dd-item 
        
        
        
        ">
      <a href="/learn/config_part_2/">
          config - part 2
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/bindings/" title="bindings" class="dd-item 
        
        
        
        ">
      <a href="/learn/bindings/">
          bindings
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/composition/" title="composition" class="dd-item 
        parent
        active
        
        ">
      <a href="/learn/composition/">
          composition
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/loaders/" title="loaders" class="dd-item 
        
        
        
        ">
      <a href="/learn/loaders/">
          loaders
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/project_structure/" title="project structure" class="dd-item 
        
        
        
        ">
      <a href="/learn/project_structure/">
          project structure
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/more/" title="more" class="dd-item 
        
        
        
        ">
      <a href="/learn/more/">
          more
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/learn/tty_mode/" title="tty-mode" class="dd-item 
        
        
        
        ">
      <a href="/learn/tty_mode/">
          tty-mode
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/extending_targets/" title="extending targets" class="dd-item 
        
        
        
        ">
      <a href="/extending_targets/">
          <b>2. </b>extending targets
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/extending_targets/operations/" title="operations" class="dd-item 
        
        
        
        ">
      <a href="/extending_targets/operations/">
          operations
          
            <i class="fa fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/targets-framework/targets"><i class='fa fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="credits/"><i class='fa fa-fw fa-bullhorn'></i> Credits</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
       
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fa fa-fw fa-history"></i> Clear History</a></li>         
      
      </ul>
    </section>
    
    <section id="footer">
      <center>

    
    <a class="github-button" href="https://github.com/targets-framework/targets" data-icon="octicon-star" data-show-count="true" aria-label="Star targets-framework/targets on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/targets-framework/targets/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork targets-framework/targets on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/targets-framework/targetslearn/composition/_index.en.md" target="blank">
                      <i class="fa fa-code-fork"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>targets</a> > <a href='/learn/'>learn targets</a> > composition
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>composition</h1>
          

        


<div class="notices info" ><p>The examples in this section build on what you learned in the <a href="/learn/bindings/">&ldquo;Bindings&rdquo; tutorial</a>.</p>
</div>


<p>Targets are run sequentially by default, but when separated by comma they will be invoked in parallel.</p>

<p>Here&rsquo;s an example of running two targets in parallel:</p>

<pre><code>mycli weather.sky,weather.temp --weather.location Chicago
[Current Temperature] 75
[Current Weather] Partly Sunny
</code></pre>

<p>Note the order of the results. Because these were run in parallel the order of the results is non-deterministic.</p>

<p>Targets is all about composing small, single-purpose targets with various operations and configuration. When you declare a group of targets and give it a name, we call this a composition.</p>

<p>You&rsquo;ve already seen a basic composition in a previous example when we learned about bindings. Now, let&rsquo;s explore Targets&rsquo; scheduler and how Targets handles the sequencing and parallelizing of target compositions.</p>

<p>Set your <code>index.js</code> file to the following:</p>

<pre><code>#!/usr/bin/env node
'use strict';

const { promisify } = require('util');
const sleep = promisify(setTimeout);
const clock = () =&gt; String(Math.floor(Date.now()/1000)).slice(-1);
const a = () =&gt; sleep(1000).then(() =&gt; `scheduler demo - ${clock()}`);
const b = [ 'a', 'a,a,a', 'a' ];
const c = [ 'b', 'b,b,b', 'b' ];

require('targets')({ targets: { a, b, c } });
</code></pre>

<p>Run <code>mycli a</code>.</p>

<p>You should see something similar to the following output print after short delay:</p>

<pre><code>[a] scheduler demo - 7
</code></pre>

<p>Now, run <code>mycli b</code>.</p>

<p>You should see something similar to the following output print out over the
course of a few seconds:</p>

<pre><code>[a] scheduler demo - 4
[a] scheduler demo - 5
[a] scheduler demo - 5
[a] scheduler demo - 5
[a] scheduler demo - 6
</code></pre>

<p>Note how the three lines in the middle all printed at the same time (the counter
shows the same number).</p>

<p>This demonstrates how the parallelized groups can be nest within greater
sequences. As a final demonstration run <code>mycli c</code>.</p>

<p>Over the course of several seconds your should see something similar to the
following output:</p>

<pre><code>[a] scheduler demo - 6
[a] scheduler demo - 7
[a] scheduler demo - 7
[a] scheduler demo - 7
[a] scheduler demo - 8
[a] scheduler demo - 9
[a] scheduler demo - 9
[a] scheduler demo - 9
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 0
[a] scheduler demo - 1
[a] scheduler demo - 1
[a] scheduler demo - 1
[a] scheduler demo - 2
[a] scheduler demo - 3
[a] scheduler demo - 3
[a] scheduler demo - 3
[a] scheduler demo - 4
</code></pre>

<p>If you scrutinize the clock output, you will see that parallel groups can be
nested within sequences and sequences can be nested in parallel groups to an
arbitrary depth. This is obviously a contrived example, but it demonstrates the
scheduling capabilities of the framework.</p>

<p>Now, not all targets output a single line at a single moment in time. Because
Targets can return streams, and if you parallelize something with a stream, you
will get interleaved results. All lines are prefixed with a label, so this should
help you sort out which output is coming from which target.</p>

<p>Let&rsquo;s take a look at a target which returns a stream.</p>

<pre><code class="language-js">#!/usr/bin/env node
'use strict';

const { spawn } = require('child_process');

const tcpdump = () =&gt; spawn('tcpdump', ['-i', 'en0', '-n', '-s', '0']);

require('targets')({ targets: { tcpdump } });
</code></pre>

<p>Now, when we run <code>sudo mycli tcpdump</code> the output from tcpdump is streamed to the console.</p>

<pre><code>sudo mycli tcpdump
[tcpdump] output here...
[tcpdump] output here...
[tcpdump] output here...
[tcpdump] output here...
[tcpdump] output here...
</code></pre>

<div class="notices info" ><p>Note that <code>sudo</code> is required for this example because tcpdump needs permission to attach to your network interface.</p>
</div>


<p>If you were to compose this with other streams or asynchrous targets, the output will be interleaved but each line will always be prefixed with the reporting target&rsquo;s label.</p>

<p><strong>TODO: add interleaved stream output example to docs.</strong></p>

<p><em><strong>Next Up:</strong> <a href="/learn/loaders/">Loaders</a></em></p>


<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/learn/bindings/" title="bindings"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/learn/loaders/" title="loaders" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1535343902"></script>
    <script src="/js/perfect-scrollbar.min.js?1535343902"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1535343902"></script>
    <script src="/js/jquery.sticky.js?1535343902"></script>
    <script src="/js/featherlight.min.js?1535343902"></script>
    <script src="/js/html5shiv-printshiv.min.js?1535343902"></script>
    <script src="/js/highlight.pack.js?1535343902"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1535343902"></script>
    <script src="/js/learn.js?1535343902"></script>
    <script src="/js/hugo-learn.js?1535343902"></script>

    <link href="/mermaid/mermaid.css?1535343902" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1535343902"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-38925830-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-38925830-2');
</script>

  </body>
</html>
